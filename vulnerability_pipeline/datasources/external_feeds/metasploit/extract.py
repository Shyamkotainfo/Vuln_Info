import csv
import os
from ...base import BaseExtractor

class MetasploitExtractor(BaseExtractor):
    def __init__(self, file_path=None):
        super().__init__("Metasploit")
        # Default to a local file if not provided
        self.file_path = file_path or "metasploit_modules.csv"

    def extract(self, since=None):
        if not os.path.exists(self.file_path):
            print(f"Metasploit data file not found at {self.file_path}")
            return
            
        try:
            with open(self.file_path, 'r', encoding='utf-8') as f:
                reader = csv.DictReader(f)
                
                count = 0 
                for row in reader:
                     # Incremental check: key is 'mod_time', typical format YYYY-MM-DD
                    if since:
                        mod_time = row.get("mod_time")
                        if mod_time and mod_time <= since:
                            continue
                    
                    yield row
                    count += 1
                
                print(f"Yielded {count} Metasploit records.")

        except Exception as e:
            print(f"Error extracting Metasploit data: {e}")
