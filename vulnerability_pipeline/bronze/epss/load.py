from vulnerability_pipeline.core.base_etl import BaseLoader
from vulnerability_pipeline.core.config import Config
from datetime import datetime

class EPSSLoader(BaseLoader):
    def __init__(self):
        super().__init__(Config.COLLECTION_EPSS, key_field="cve")

    def transform(self, item):
        doc = {
            "cve": item.get("cve"),
            "epss": float(item.get("epss", 0) or 0),
            "percentile": float(item.get("percentile", 0) or 0),
            "date": item.get("date", datetime.utcnow().strftime("%Y-%m-%d")),
            # ingested_at added by base
        }
        return doc
